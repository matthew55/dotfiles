#!/bin/sh

# Usage:
#	stonks <ticker> <company name> <icon>
#	stonks gme "Gamestop Corps" ðŸ“ˆ
# When the name of the company is multi-word, put it in quotes.

# Require an icon.
[ -z "$3" ] && exit 1

interval="14" # Days of history contained in chart.
dir="${XDG_DATA_HOME:-$HOME/.local/share}/stock-prices"
pricefile="$dir/$1"
chartfile="$dir/$1-chart"

updateprice() { temp="$(mktemp)"
    # Stip the colors manually.
	stonks "$1" | grep -i "$1" | awk '{print $4}' > "$temp" && 
		mv -f "$temp" "$pricefile" &&
		stonks -d $interval $1 > "$temp" &&
		mv -f "$temp" "$chartfile" ;}

[ -d "$dir" ] || mkdir -p "$dir"

[ "$(stat -c %x "$pricefile" 2>/dev/null | cut -d' ' -f1)" != "$(date '+%Y-%m-%d')" ] &&
	updateprice "$1"

# case $BLOCK_BUTTON in
# 	1) setsid "$TERMINAL" -e less -Srf "$chartfile" ;;
# 	2) notify-send -u low "$3 Updating..." "Updating $2 price..."
# 		updateprice "$1" && notify-send "$3 Update complete." "$2 price is now
# \$$(cat "$pricefile")" ;;
# 	3) uptime="$(date -d "$(stat -c %x "$pricefile")" '+%D at %T' | sed "s|$(date '+%D')|Today|")"
# 		notify-send "$3 $2 module" "\- <b>Exact price: \$$(cat "$pricefile")</b>
# - Left click for chart of changes.
# - Middle click to update.
# - Shows ðŸ”ƒ if updating prices.
# - <b>Last updated:
# 	$uptime</b>" ;;
# 	6) "$TERMINAL" -e "$EDITOR" "$0" ;;
# esac

echo "$3\$$(cat "$pricefile")"
